[build]
  command = "yarn build"
  publish = "dist"
  functions = "netlify/functions"
  targetPort = 5173

[build.environment]
  NODE_VERSION = "24"
  # Ubuntu Noble 24.04 is the default build image

[[headers]]
  for = "/index.html"
  [headers.values]
    Cache-Control = "no-cache, no-store, must-revalidate"
    Pragma = "no-cache"
    Expires = "0"

[[headers]]
  for = "/service-worker.js"
  [headers.values]
    Content-Type = "application/javascript"
    Cache-Control = "no-cache, no-store, must-revalidate"
    Pragma = "no-cache"
    Expires = "0"

[[headers]]
  for = "/assets/*.js"
  [headers.values]
    Content-Type = "application/javascript"
    X-Content-Type-Options = "nosniff"
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/assets/*.css"
  [headers.values]
    Content-Type = "text/css"
    X-Content-Type-Options = "nosniff"
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/assets/*.json"
  [headers.values]
    Content-Type = "application/json"
    X-Content-Type-Options = "nosniff"
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/assets/*.png"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[redirects]]
  from = "/share-redirect.html"
  to = "/share-redirect.html"
  status = 200

# Note: /share-target/* redirect removed - service worker handles POST requests
# The SPA fallback will serve index.html, and the service worker intercepts POST

# Exclude assets from SPA fallback - must come before catch-all
# This handles all assets including manifest.json, CSS, JS files
[[redirects]]
  from = "/assets/*"
  to = "/assets/:splat"
  status = 200
  force = true

# Exclude service worker from SPA fallback
[[redirects]]
  from = "/service-worker.js"
  to = "/service-worker.js"
  status = 200
  force = true

# Exclude favicon from SPA fallback
[[redirects]]
  from = "/favicon.png"
  to = "/favicon.png"
  status = 200
  force = true

# Note: /share-target/* is NOT excluded from SPA fallback
# This allows POST requests to /share-target/ to fall through to SPA fallback
# The service worker will intercept the POST before it reaches the server
# This is the correct behavior for Web Share Target API

# SPA fallback - must be last
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200